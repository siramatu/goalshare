<!DOCTYPE html>
<html lang="ja">
<head>
<title>GoalShare</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />

<link href="css/default.css" rel="stylesheet" type="text/css" />
<link href="css/font-awesome.min.css" rel="stylesheet" type="text/css" />

<script type="text/javascript" src="js/jquery-2.0.3.js"></script>
<link rel="stylesheet"
	href="css/ui-lightness/jquery-ui-1.10.3.custom.css" />
<link rel="stylesheet" href="css/jquery.multiselect.css" />

<script src="js/jquery-ui-1.10.3.custom.min.js"></script>
<script src="js/jquery.multiselect.js"></script>
<script src="js/jquery.localize.js"></script>
<script src="js/purl.js"></script>

<!-- <script src="js/jquery.min.js"></script>  
<link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/blitzer/jquery-ui.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.1/jquery.min.js"></script>
 <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.12/jquery-ui.min.js"></script>
 <script type="text/javascript" src="js/jquery.collapse.js"></script> -->

<script src="js/goalshare.js"></script>
<script type="text/javascript" src="js/nav.js"></script>
<script type="text/javascript" src="js/fb.js"></script>

</head>
<body>
<script type="text/javascript">
var res
</script>
	<div class="header">
		<img class="logo" src="image/logo.png" width="350" alt="GoalShare" />
		<div class="catch" data-localize="Slogan">Share public goals → Find collaborators</div>
		<div class="languageSelect">
			<a class="languageSelector" data-language="jp"><img src="img/flags/jp"/></a>
			<a class="languageSelector" data-language="en"><img src="img/flags/us"/></a>
			<a class="languageSelector" data-language="fi"><img src="img/flags/fi"/></a>
		</div>
		<div class="loginWrapper">
				<a class="login" href="login.html" data-localize="Act_SignUpSignIn">Sign up / Sign in</a>
		</div>
	</div>
	<!-- header -->

	<div class="content">

		<div class="nav">
			<ul>
				<li class="issue"><a href="#issue" data-localize="Nav_Issues">Issues</a></li>
				<li class="goal"><a href="#goal" data-localize="Nav_Goals">Goals</a></li>
				<li class="point"><a href="#point" data-localize="Nav_Maps">Maps</a></li>
				<li class="agent"><a href="#agent" data-localize="Nav_People">People</a></li>
				<li class="date"><a href="#date" data-localize="Nav_Chronology">Chronology</a></li>
			</ul>
		</div>
		<!-- nav -->


		<div id="issue" class="visualizer">
			<a name="issue" />
			<div class="visu_head">
				<div class="title"  data-localize="Nav_Issues">Issues</div>
				<div class="data_class" data-localize="Socia_Issue">socia:Issue</div>
			</div>
		</div>
		<!-- visualizer -->

		<div id="goal" class="visualizer">
			<a name="goal" />
			<div class="visu_head">
				<div class="title" data-localize="Nav_Goals">Goals</div>
				<div class="data_class" data-localize="Socia_goal">socia:Goal</div>
				<div class="filter_section">
					<div class="filter_group">
						<div class="filter">
							<label data-localize="StartDate">Start date</label> <input type="text" name="startDate"
								id="startDate" />
						</div>
						<div class="filter">
							<label data-localize="EndDate">End date</label> <input type="text" name="endDate"
								id="endDate" />
						</div>
						<div class="filter clear">
							<div class="select">
								<input type="radio" name="dateType" value="CreatedDate" checked /><span data-localize="CreatedDate">Created date</span>
								<input type="radio" name="dateType" value="DesiredDate" /><span data-localize="DesiredDate">Desired date</span> 
								<input type="radio" name="dateType" value="RequiredDate" /><span data-localize="RequiredDate">Required date</span>
							</div>
						</div>
					</div>


					<div class="filter_group">
						<div class="filter">
							<label data-localize="CreatedBy">Created by</label> <input type="text" id="createdBy" />
						</div>
						<div class="filter">
							<label data-localize="Keyword">Keyword</label> <input type="text" id="keyword" />
						</div>
					</div>
					<div class="filter_group">
						<div class="filter">
							<label data-localize="Status">Status</label> <select id="goalStatus" name="Status"
								multiple="multiple">
								<option value="NotStarted" data-localize="Status_NotStarted">Not started</option>
								<option value="InProgress" data-localize="Status_InProgress">In progress</option>
								<option value="Completed" data-localize="Status_Completed">Completed</option>
								<option value="Aborted" data-localize="Status_Aborted">Aborted</option>
							</select>
						</div>
						<div class="filter">
							<label data-localize="ResultLimit">Result limit</label> <input id="resultLimit" type="text"
								value="5" />
						</div>
					</div>
					<div class="clear" />
					<div>
						<button id="goalSubmit" class="ui-button" data-localize="Act_Search">Search</button>
					</div>
					<div>
						<button id="goalCreate" class="ui-button" data-localize="Act_CreateGoal">Create new goal</button>
					</div>
				</div>

			</div>
			<div class="dataWrapper">
				<div class="dataHolder">
					<div class="resource">
						<span class="goal_path">Recovery from earthquake > <span
							class="this_goal">Decommissioning of Fukushima Daiichi
								Nuclear Plant</span></span>
	
						<h2 class="active">
							<img src="image/nobody.png" class="icon" />
							<div class="fukidashi">Decommissioning of Fukushima Daiichi
								Nuclear Plant</div>
						</h2>
						<div>
							<span class="leader">Tokyo Electric Power Co., Inc.
								(Non-approved data)<br /> <span class="cite">Citation
									from: <u>Sankei Shimbun</u>
							</span><br /> <span class="input">Input: viva45, 2012-11-26</span>
						</div>
					</div>
					<!-- resource -->
	
					<div class="resource">
	
						<span class="goal_path">Recovery from earthquake > Restart
							farming in X Village > <span class="this_goal">Recover
								drain in X Village</span>
						</span>
	
						<h2>
							<img src="image/nobody.png" class="icon" />
							<div class="fukidashi">Recover drain in X Village</div>
						</h2>
	
						<div>
							<span class="leader">tanaka_bz<br /> <span class="input">Input:
									tanaka_bz, 2013-06-21</span>
						</div>
					</div>
					<!-- resource -->
	
					<div class="resource">
	
						<span class="goal_path">Recovery from earthquake >
							Attraction of tourists to X Village > <span class="this_goal">Hold
								town walking tours in X Village</span>
						</span>
	
						<h2>
							<img src="image/nobody.png" class="icon" />
							<div class="fukidashi">Hold town walking tours in X Village</div>
						</h2>
	
						<div>
							<span class="leader">tanaka_bz etc.か<br /> <span
								class="input">Input: tanaka_bz, 2013-07-02</span>
						</div>
					</div>
					<!-- resource -->
	
				</div>
				<div class="detailHolder">
					<div id="detailFloat">
						<div class="detailHeader">
							<label data-localize="GoalShare">Details</label>
						</div>
						<div class="detailBody"></div>
						
					</div>
				</div>
			</div> <!-- data wrapper -->



		</div>
		<!-- visualizer -->


		<div id="point" class="visualizer">
			<a name="point" />
			<div class="visu_head">
				<div class="title">場所</div>
				<div class="data_class">geo:Point</div>
			</div>
		</div>
		<!-- visualizer -->

		<div id="agent" class="visualizer">
			<a name="agent" />
			<div class="visu_head">
				<div class="title">人と組織</div>
				<div class="data_class">foaf:Agent</div>
			</div>
		</div>
		<!-- visualizer -->


		<div id="date" class="visualizer">
			<a name="date" />
			<div class="visu_head">
				<div class="title">達成予定</div>
				<div class="data_class">schema:Duration</div>
			</div>
		</div>
		<!-- visualizer -->

	</div>
	<!-- content -->

	<hr />
	<script type="text/javascript">
		function jpcb(data) {
			console.log(data);
		}
	</script>
	<div id="test"></div>

</body>

<!-- Hidden element for the add goal dialog -->
<div id="goalEditDialogContent" class="editDialog ui-helper-hidden" title="Goal">
	<form>
		<table>
			<thead></thead>
			<tbody>
				<tr>
					<td>
						<label data-localize="ParentGoal">Parent goal</label>
					</td>
					<td>
						<input type="text" id="parentGoalEdit" /> 
					</td>
				</tr>
				<tr>
					<td>
						<label data-localize="Title">Title</label>
					</td>
					<td>
						<input id="goalTitleEdit" type="text" />
					</td>
				</tr>
				<tr>
					<td>
						<label data-localize="Description">Description</label>
					</td>
					<td>
						<textarea id="goalDescriptionEdit" rows="6"></textarea>
					</td>
				</tr>
				<tr>
					<td>
						<label data-localize="Status">Status</label>
					</td>
					<td><select id="goalStatusEdit">
							<option value="NotStarted" selected>Not started</option>
							<option value="InProgress">In progress</option>
							<option value="Completed">Completed</option>
							<option value="Aborted">Aborted</option>
						</select></td>
				</tr>
				<tr>
					<td>
						<label data-localize="DesiredDate">Desired date</label>
					</td>
					<td><input type="text" id="goalDesiredDateEdit" /></td>
				</tr>
				<tr>
					<td>
						<label data-localize="RequiredDate">Required date</label>
					</td>
					<td><input type="text" id="goalRequiredDateEdit" /></td>
				</tr>
				<tr>
					<td>
						<label data-localize="CreatedDate">Created date</label>
					</td>
					<td><input type="text" id="goalCreatedDateEdit" disabled /></td>
				</tr>
				<tr>
					<td>
						<label data-localize="Reference">Reference</label>
					</td>
					<td><input type="text" id="goalReferenceEdit"/></td>
				</tr>
			</tbody>
		</table>
	</form>
</div>

<!-- Goal details  -->
<div id="goalDetailsContent" class="editDialog ui-helper-hidden" title="Goal">
		<table>
			<thead></thead>
			<tbody>
				<tr>
					<td>
						<label>Parent goal</label>
					</td>
					<td>
						<div id="parentGoalDetails"></div> 
					</td>
				</tr>
				<tr>
					<td>
						<label>Title</label>
					</td>
					<td>
						<div id="goalTitleDetails"></div>s
					</td>
				</tr>
				<tr>
					<td>
						<label>Status</label>
					</td>
					<td>
						<div id="goalStatusDetails"></div>
					</td>
				</tr>
				<tr>
					<td>
						<label>Desired date</label>
					</td>
					<td>
					<div id="GoalDesiredDateDetails"></div>
				</tr>
				<tr>
					<td>
						<label>Required date</label>
					</td>
					<td>
						<div id="goalRequiredDateEdit"></div>
					</td>
				</tr>
				<tr>
					<td>
						<label>Created date</label>
					</td>
					<td>
						<div id="goalCreatedDateEdit"></div>
					</td>
				</tr>
				<tr>
					<td>
						<label>Reference</label>
					</td>
					<td><div id="goalReferenceEdit"></div></td>
				</tr>
			</tbody>
		</table>	
</div>
<script type="text/javascript">




$(function() {

   var fixadent = $("#detailFloat"), pos = fixadent.offset();

   $(window).scroll(function() { 

     if($(this).scrollTop() > (pos.top + 10) && fixadent.css('position') == 'static') { fixadent.addClass('fixed'); } 

     else if($(this).scrollTop() <= pos.top && fixadent.hasClass('fixed')){ fixadent.removeClass('fixed'); }

   })

});



</script>

<script type="text/javascript">

var goalsAutocomplete;
$.getJSON("/api/autocomplete.pl", { type: "goals"},
	function(data){
	goalsAutocomplete = data.goals;
	});
// Clear the goal edit form and set default values
function resetGoalEditSelection(){
	$("#parentGoalEdit").val("");
	$("#goalTitleEdit").val("");
	$("#goalDescriptionEdit").val("");
	$("#goalRequiredDateEdit").datepicker("setDate", new Date());
	$("#goalDesiredDateEdit").datepicker("setDate", new Date());
	$("#goalCreatedDateEdit").datepicker("setDate", new Date());
	$("#goalReferenceEdit").val("");
	
}

// Init goal edit dialog
function goalEditInit(){
	

	$("#goalDesiredDateEdit").datepicker({
		buttonImage : "calendar.gif",
		buttonText : "Calendar",
		altFormat : "dd.mm.yy",
		dateFormat: "yy-mm-dd"
	}).datepicker("setDate", ((new Date).getDate() + 30));

	$("#goalRequiredDateEdit").datepicker({
		buttonImage : "calendar.gif",
		buttonText : "Calendar",
		altFormat : "dd.mm.yy",
		dateFormat: "yy-mm-dd"
	}).datepicker("setDate", ((new Date).getDate() + 30));
	
	$("#goalCreatedDateEdit").datepicker({
		buttonImage : "calendar.gif",
		buttonText : "Calendar",
		altFormat : "dd.mm.yy",
		dateFormat: "yy-mm-dd"
	}).datepicker("setDate", new Date());
	/* $("#goalStatusEdit").multiselect({
		height : 110,
		minWidth : 150,
		noneSelectedText : "None",
		//selectedText : "# selected",
		checkAllText : "All",
		uncheckAllText : "None",
		multiple: false
		
	});
 */	
	resetGoalEditSelection();
}

function addGoal(parentGoalURI, goalTitle, details, desiredDate, requiredDate, creator, createdDate, status, reference){
	console.log("Title " + goalTitle);
	$.get("api/insert_goal.pl", { parentGoalURI: parentGoalURI,
								  title: goalTitle,
								  details: details,
								  reference: reference,
								  desiredDate: desiredDate,
								  requiredDate: requiredDate,
								  creator: creator,
								  createdDate: createdDate,
								  status: status});
}


	
// Opens goal edit dialog. If parent goal uri is given, it is set automatically.
function openGoalEdit(parentGoalURI){
	
	resetGoalEditSelection();
	$("#goalEditDialogContent").dialog({
		modal: true,
		width: 'auto',
		height: 'auto',
		close: function(event, ui){
			//$("#goalEditDialogContent").show();
		 },
		 closeOnEscape: true,
		 open: function(){$("#parentGoalEdit").autocomplete({source: goalsAutocomplete });},
		 buttons: [ {
			 			text: Locale.dict.Act_Apply,
						click: function(){
				 			addGoal($("#parentGoalEdit").val(),
				 					$("#goalTitleEdit").val(),
				 					$("#goalDescriptionEdit").val(),
				 					(new Date( Date.parse($("#goalDesiredDateEdit").datepicker().val()) ).format(Locale.dict.X_FullDateFormat)) + getTimezoneOffset(),
				 					(new Date( Date.parse($("#goalRequiredDateEdit").datepicker().val()) ).format(Locale.dict.X_FullDateFormat)) + getTimezoneOffset(),
				 					"Creator",
				 					(new Date().format(Locale.dict.X_FullDateFormat)) + getTimezoneOffset(),
				 					$("#goalStatusEdit").val(),
				 					$("#goalReferenceEdit").val()
				 			)
							resetGoalEditSelection();
							$(this).dialog("close");
			 			}
		 			},
		 			{
		 				text: Locale.dict.Act_Cancel,
						click: function(){
			 				$(this).dialog("close");
		 				}
		 			}
		 		],
	});
	console.log("Opening add dialog for " + parentGoalURI);
	if(parentGoalURI){
		$("#parentGoalEdit").val(parentGoalURI)
	}
}

$(document).ready(function(){
	goalEditInit();
});

function openGoalPreview(goalURI){
	
}

</script>
<!--  End edit goal form -->


<script type="text/javascript">
	
	function getTimezoneOffset(){
		var offset = new Date().getTimezoneOffset();
		offset = ((offset<0? '+':'-')+ // Note the reversed sign!
		          pad(parseInt(Math.abs(offset/60)), 2)+
		          pad(Math.abs(offset%60), 2));
		return offset;
	}

	function fetchGoalsSuccess(data) {
		var dataHolder = $("#goal .dataHolder");
		// Contains goal dom elements to be appended
		var resources = [];
		$.each(data.goals, function(key, val) {
			// Build the element for the resource 
			var element = $("<div />").addClass("resource").append($("<div />"));
			//console.log(val.title);
			// Goal path

			if (val.goalPath) {
				var pathElement = $("<div />").addClass("mediumTitle").text(val.goalPath);
				$(element).append(pathElement);

			}
			
			
			// Goal status
			var status = Locale.dict.Status_Unknown;
			switch(val.status){
				case "NotStarted":
					status = Locale.dict.Status_NotStarted;
					break;
				case "InProgress":
					status = Locale.dict.Status_InProgress;
					break;
				case "Completed":
					status = Locale.dict.Status_Completed;
					break;
				case "Aborted":
					status = Locale.dict.Status_Aborted;
					break;
			}
			var statusElement  = $("<div />").addClass("status").addClass(val.status);
			$(statusElement).append($("<div />").addClass("statusLeft").append( $("<div />").addClass("icon").addClass(val.status) )
												.append( $("<div />").addClass("statusHeader").text(status) ));
			var statusTime = $("<div />").addClass("statusRight");
			try{
				var desDate = new Date(Date.parse(val.desiredTargetDate));	
				$(statusTime).append( $("<span />").text(Locale.dict.DesiredDate + ": " + desDate.format(Locale.dict.X_DateFormat)) );
			}catch(err){
				$(statusTime).append( $("<span />").text(Locale.dict.DesiredDate + ": -"));
			}
			try{
				var reqDate = new Date(Date.parse(val.requiredTargetDate));
				$(statusTime).append( $("<span />").text(Locale.dict.RequiredDate + ": " + regDate.format(Locale.dict.X_DateFormat)) );
			}catch(err){
				$(statusTime).append( $("<span />").text(Locale.dict.RequiredDate + ": - ") );
			}
			$(statusElement).append( statusTime );
			
			$(element).append( statusElement );
			
			// Image and Fukidashi
			//console.log(val.title);
			var test = (!val.img) ? "image/nobody.png" : val.img;
			$(element).append(
					$("<h2 />").append(
							$("<img />").addClass("icon").attr("src", test))
							.append(
									$("<div />").addClass("fukidashi").text(
											val.title)));

			// Info 
			var creator = val.creator;
			var creatorUrl = val.creatorUrl;
			var wisherName = (!val.wisher || !val.wisher.value) ? "???"
					: val.wisher.value;			
			var wisherUri = (!val.wisher || !val.wisher.value) ? "???"
					: val.wisher.value;
			var input = (!val.input || !val.input.value) ? "???"
					: val.input.value;
			$(element).append(
					$("<div />").append(
							$("<a />").attr("href", creatorUrl).append(
									$("<div />").addClass("leader").text(
											creator))));
			try{
				var crDate = new Date(Date.parse(val.dateTime));
				$(element).append($("<div />").append(
								$("<span />").addClass("input").text( Locale.dict.CreatedDate + ": " + crDate.format(Locale.dict.X_DateFormat))));
			}catch(err){
				
			}
			
			$(element).append($("<div />")			
							.append( $("<button />")
										.addClass("ui-button").addClass("ui-button-small")
										.text(Locale.dict.Act_AddSubgoal)
										.data("goalUrl", val.url)
										.click( function(){ 
															openGoalEdit($(this).data("goalUrl")); } ) 
										));
			//console.log("Goal url "+ val.url);
			$("<div />").addClass("subgoalPlaceHolder")
						//.addClass("sub-resource")
						.append($("<button />")
								.addClass("ui-button").addClass("ui-button-small")
								.text(Locale.dict.Act_listSubgoals)
								.data("goalUrl", val.url)
								.click(function() {
									$(this).nextAll("div").remove();
									var placeholder = $("<div />" ).addClass("subResourcesHolder")
																	.append( $("<div />").addClass("subRecourceHeader")
																						.append( $("<h3 />").text(Locale.dict.SubGoals) )
																						.append( $("<p />").text(Locale.dict.SubGoals_HeaderText) )
																		)
														.insertAfter(this);
									
									var param = {};
									param["goalUrl"] = $(this).data("goalUrl");
									//console.log("Subgoal" + $(this).data("goalUrl"));
									
									$.getJSON("/api/query_subgoals.pl",
												param,
												function(data){
													// Append subgoals
													$.each(data.subgoals, function(key, subGoal){
														
														// Goal status
														var status = Locale.dict.Status_Unknown;
														switch(val.status){
															case "NotStarted":
																status = Locale.dict.Status_NotStarted;
																break;
															case "InProgress":
																status = Locale.dict.Status_InProgress;
																break;
															case "Completed":
																status = Locale.dict.Status_Completed;
																break;
															case "Aborted":
																status = Locale.dict.Status_Aborted;
																break;
														}
														var statusElement  = $("<div />").addClass("status").addClass(val.status);
														$(statusElement).append($("<div />").addClass("statusLeft").append( $("<div />").addClass("icon").addClass(val.status) )
																							.append( $("<span />").addClass("statusHeader").text(status) ));
														var statusTime = $("<div />").addClass("statusRight");
														try{
															var desDate = new Date(Date.parse(val.desiredTargetDate));	
															$(statusTime).append( $("<span />").text(Locale.dict.DesiredDate + ": " + desDate.format(Locale.dict.X_DateFormat)) );
														}catch(err){
															$(statusTime).append( $("<span />").text(Locale.dict.DesiredDate + ": -"));
														}
														try{
															var reqDate = new Date(Date.parse(val.requiredTargetDate));
															$(statusTime).append( $("<span />").text(Locale.dict.RequiredDate + ": " + regDate.format(Locale.dict.X_DateFormat)) );
														}catch(err){
															$(statusTime).append( $("<span />").text(Locale.dict.RequiredDate + ": - ") );
														}
														$(statusElement).append( statusTime );
														var subCreated;
														try{
															console.log(subGoal.created);
															var creDate = new Date(Date.parse(subGoal.created));
															subCreated = Locale.dict.CreatedDate + ": " + creDate.format(Locale.dict.X_DateFormat);
														}catch(err){
															subCreated = Locale.dict.CreatedDate + ": -";
														}
														
														$("<div />").addClass("subResource").append( 
																			$("<div />").append( $("<img />").addClass("icon").attr("src", "image/nobody.png") )
																						.append( $("<a />").attr("href", subGoal.url).append( $("<span />").addClass("subtitle").text(subGoal.title) ) )
																						.append(statusElement)
																  						.append( $("<div />").addClass("leader").text(Locale.dict.Name)// Todo name
																  						.append( $("<div />").addClass("leader").text( 	subCreated ) )
																  								)
																			  			
														).append( $("<div />").addClass("clear") )
														.appendTo(placeholder);
														console.log("ok");
													});
												});//Json
									console.log("ok");
								}))		
						.append( $("<div />").addClass("clear") )
						.appendTo( $(element) 	);
			$(element).append( $("<div />").addClass("clear") );

			$("#goal div.dataHolder").append(element);

		});

		console.log(data);
	}

	function setupGoalFilters() {
		var today = new Date();
		var prev = new Date();
		prev.setDate(today.getDate() - 60);

		$("#startDate").datepicker({
			buttonImage : "calendar.gif",
			buttonText : Locale.dict.Calendar,
			altFormat : "dd.mm.yy",
			dateFormat: Locale.dict.X_DateFormatJQ
		}).datepicker("setDate", prev);

		$("#endDate").datepicker({
			buttonImage : "calendar.gif",
			buttonText : Locale.dict.Calendar,
			altFormat : "dd.mm.yy",
			dateFormat: Locale.dict.X_DateFormatJQ
		}).datepicker("setDate", today);

		$("#goalStatus").multiselect({
			height : 110,
			minWidth : 150,
			noneSelectedText : Locale.dict.T_MultiSelect_None,
			selectedText : Locale.dict.T_MultiSelect_SelectedText,
			checkAllText : Locale.dict.T_MultiSelect_All,
			uncheckAllText : Locale.dict.T_MultiSelect_None
		});
		
		$("#createdBy").autocomplete();
		
		$.getJSON("/api/autocomplete.pl", { type: "creators" },
				function(data){
			$("#createdBy").autocomplete({source: data.Creators});
				});

		$("#goalSubmit").click(
				function() {
					// Clear old goals
					$("#goal div.dataHolder").children().remove();

					
					
					
					
					
					var qData = {};
					qData["startTime"] = (new Date( Date.parse($("#startDate").datepicker().val()) ).format("yyyy-MM-ddThh:mm:ss")) + getTimezoneOffset();
					qData["endTime"] = (new Date( Date.parse($("#endDate").datepicker().val()) ).format("yyyy-MM-ddThh:mm:ss")) + getTimezoneOffset();
					qData["dateType"] = $('input:radio[name=dateType]:checked').val();
					qData["num"] = $("#resultLimit").val();
					qData["created"] = $("#createdBy").val();
					qData["keyword"] = $("#keyword").val();
					console.log($("#goalStatus").val());
					if ($("#goalStatus").val())
						qData["goalStatus"] = $("#goalStatus").val().join(";");
					console.log(qData);

					$.getJSON("/api/query_goals.pl", qData,
							fetchGoalsSuccess);
					//.getJSON("http://localhost/cgi-bin/query_goals.pl", qData).done(fetchGoalsSuccess);
				});
	}
	function setupGoalCommands(){
		$("#goalCreate").click(function(){
			openGoalEdit();
		});
	}
	function setupNavigation(){
		$(".languageSelector").click(function(){
			insertParam("lang", $(this).data("language"));
		});
	}

	$(document).ready(function() {
		// Set the controls
		if( $.url().param("lang") ){
			Locale.setLanguage($.url().param("lang"));
			$("[data-localize]").localize("locale", { language: $.url().param("lang") });
		}else{
			$("[data-localize]").localize("locale", { language: "en" });
		}
		setupGoalFilters();
		setupGoalCommands();
		setupNavigation();
		$("#goalSubmit").click();
	});

	</script>
</html>

